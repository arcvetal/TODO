var taskList=document.querySelector(".task-list"),templateList=document.querySelector(".list-template__task-list"),deleteIcon=document.querySelector(".delete-icon"),deleteIconTemplate=document.querySelector(".delete-icon--template"),taskReadyArr=[].slice.call(taskList.querySelectorAll(".task__ready")),doneMark=document.querySelector(".task__ready--done");doneMark&&deleteIcon.classList.add("delete-icon--show");var onTaskDone=function(t){t.addEventListener("click",function(e){e.target.classList.contains("task__ready")&&(e.target.classList.toggle("task__ready--done"),e.target.nextElementSibling.classList.toggle("task__text--done"),e.target.parentElement.classList.toggle("task--done"),t.querySelector(".task__ready--done")?deleteIcon.classList.add("delete-icon--show"):deleteIcon.classList.remove("delete-icon--show"))})};onTaskDone(taskList),deleteIcon.addEventListener("click",function(e){for(var t=[].slice.call(document.querySelectorAll(".task--done")),a=0;a<t.length;a++)t[a].remove();deleteIcon.classList.remove("delete-icon--show"),updateData()});var formBtn=document.querySelector(".form__btn"),btnList=document.querySelector(".create__items"),overlay=document.querySelector(".overlay");formBtn.addEventListener("click",function(e){formBtn.classList.toggle("form__btn--active"),btnList.classList.toggle("create__items--active"),overlay.classList.toggle("overlay--active")});var listTemplate=document.querySelector(".list-template"),templateTitile=listTemplate.querySelector(".list-template__title"),templateCount=listTemplate.querySelector(".list-template__count"),templateTaskList=document.querySelector(".list-template__task-list"),templateItem=document.querySelector(".list-template__task--template"),templateReady=templateItem.querySelector(".list-template__task-ready"),templateText=templateItem.querySelector(".list-template__task-text"),templateDate=templateItem.querySelector("task__date"),categoryList=document.querySelector(".category__list"),callback=function(e){var t=e.target;"LI"===event.target.parentElement.tagName&&(t=event.target.parentElement);var a=getComputedStyle(t).getPropertyValue("background-color"),l=t.firstElementChild.innerText,n=t.lastElementChild.innerText;listTemplate.style.backgroundColor=a,templateTitile.textContent=l,templateCount.textContent=n;var o=t.id.slice(4);!function(){for(var e=[].slice.call(taskList.querySelectorAll(".task--"+o)),t=document.createDocumentFragment(),a=0;a<e.length;a++){var l=document.createElement("div");l.classList.add("list-template__task"),l.classList.add("list-template__task--template");var n=document.createElement("div");n.classList.add("list-template__task-ready"),l.appendChild(n);var s=document.createElement("p");s.classList.add("list-template__task-text"),l.appendChild(s);var c=document.createElement("span");c.classList.add("list-template__task-date"),l.appendChild(c),s.textContent=e[a].textContent,t.appendChild(l)}templateTaskList.innerHTML="",templateTaskList.appendChild(t)}()};categoryList.addEventListener("click",callback),onTaskDone(templateTaskList);var onTaskDoneTemplate=function(t){t.addEventListener("click",function(e){e.target.classList.contains("list-template__task-ready")&&(e.target.classList.toggle("list-template__task-ready--done"),e.target.nextElementSibling.classList.toggle("list-template__task-text--done"),e.target.parentElement.classList.toggle("list-template__task--done"),t.querySelector(".list-template__task-ready--done")?deleteIconTemplate.classList.add("delete-icon--show"):deleteIconTemplate.classList.remove("delete-icon--show"))})};onTaskDoneTemplate(templateList),deleteIconTemplate.addEventListener("click",function(e){for(var t=[].slice.call(document.querySelectorAll(".list-template__task--done")),a=[],l=0;l<t.length;l++)a[l]=t[l].textContent,t[l].remove();console.dir(a);var n=[].slice.call(taskList.querySelectorAll(".task"));for(l=0;l<t.length;l++)for(var s=0;s<n.length;s++)n[s].textContent===t[l].textContent&&n[s].remove();deleteIconTemplate.classList.remove("delete-icon--show"),updateData()});var updateData=function(){for(var e=[].slice.call(taskList.querySelectorAll(".task")),t=[].slice.call(categoryList.querySelectorAll(".category__item")),a={},l=0;l<t.length;l++)a[t[l].id.slice(4)]=0;!function(e){var t,a;for(key in e)a=categoryList.querySelector("#cat_"+key+" .category__count"),0===(t=e[key])?a.innerText="Нет задач":1===t?a.innerText=t+" задача":2<=t&&t<=4?a.innerText=t+" задачи":5<=t&&t<=20&&(a.innerText=t+" задач")}(function(e,t){for(var a=0;a<e.length;a++)e[a].classList.contains("task--work")?t.work++:e[a].classList.contains("task--personal")?t.personal++:e[a].classList.contains("task--shopping")?t.shopping++:e[a].classList.contains("task--family")?t.family++:e[a].classList.contains("task--warning")&&t.warning++;return t}(e,a))};updateData();var createNewTask=function(){document.createElement("div").classList.add("new-task");var e=document.createElement("div"),t=document.createElement("button"),a=document.createElement("button");e.appendChild(t),e.appendChild(a);var l=document.createElement("div"),n=document.createElement("div"),s=document.createElement("div"),c=document.createElement("input");n.appendChild(s),n.appendChild(c),l.appendChild(n)},createTask=function(e){e||(e=0);var t=document.createElement("li");t.classList.add("new-task__item");var a=document.createElement("div");a.classList.add("new-task__ready");var l=document.createElement("input");return l.id="new-task-"+ ++e,l.name="new-task",l.type="text",l.placeholder="Что нужно сделать ?",t.appendChild(a),t.appendChild(l),t},inputNewTask=document.querySelector("#new-task-1"),itemTemplate=document.querySelector(".new-task__item");itemTemplate.addEventListener("keydown",function(e){var t=document.querySelector(".new-task__list");if(13===e.keyCode){e.preventDefault();var a=createTask(0);t.appendChild(a)}});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRhc2stbWFyay1hbmltYXRlLmpzIl0sIm5hbWVzIjpbInRhc2tMaXN0IiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwidGVtcGxhdGVMaXN0IiwiZGVsZXRlSWNvbiIsImRlbGV0ZUljb25UZW1wbGF0ZSIsInRhc2tSZWFkeUFyciIsInNsaWNlIiwiY2FsbCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJkb25lTWFyayIsImNsYXNzTGlzdCIsImFkZCIsIm9uVGFza0RvbmUiLCJ3cmFwcGVyTm9kZSIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwidGFyZ2V0IiwiY29udGFpbnMiLCJ0b2dnbGUiLCJuZXh0RWxlbWVudFNpYmxpbmciLCJwYXJlbnRFbGVtZW50IiwicmVtb3ZlIiwidGFza0RvbmVBcnIiLCJpIiwibGVuZ3RoIiwidXBkYXRlRGF0YSIsImZvcm1CdG4iLCJidG5MaXN0Iiwib3ZlcmxheSIsImxpc3RUZW1wbGF0ZSIsInRlbXBsYXRlVGl0aWxlIiwidGVtcGxhdGVDb3VudCIsInRlbXBsYXRlVGFza0xpc3QiLCJ0ZW1wbGF0ZUl0ZW0iLCJ0ZW1wbGF0ZVJlYWR5IiwidGVtcGxhdGVUZXh0IiwidGVtcGxhdGVEYXRlIiwiY2F0ZWdvcnlMaXN0IiwiY2FsbGJhY2siLCJ0YXJnIiwiZXZlbnQiLCJ0YWdOYW1lIiwiY29sb3JUYXJnZXQiLCJnZXRDb21wdXRlZFN0eWxlIiwiZ2V0UHJvcGVydHlWYWx1ZSIsInRpdGxlVGFyZ2V0IiwiZmlyc3RFbGVtZW50Q2hpbGQiLCJpbm5lclRleHQiLCJjb3VudGVyVGFyZ2V0IiwibGFzdEVsZW1lbnRDaGlsZCIsInN0eWxlIiwiYmFja2dyb3VuZENvbG9yIiwidGV4dENvbnRlbnQiLCJpZENhdGVnb3J5IiwiaWQiLCJ0ZW1wbGF0ZVRhc2tBcnIiLCJmcmFnbWVudCIsImNyZWF0ZURvY3VtZW50RnJhZ21lbnQiLCJuZXdJdGVtIiwiY3JlYXRlRWxlbWVudCIsIm5ld0l0ZW1SZWFkeSIsImFwcGVuZENoaWxkIiwibmV3SXRlbVRleHQiLCJuZXdJdGVtRGF0ZSIsImlubmVySFRNTCIsImNyZWF0ZVRhc2tFbGVtIiwib25UYXNrRG9uZVRlbXBsYXRlIiwidGV4dENvbnRlbnRBcnIiLCJjb25zb2xlIiwiZGlyIiwidGFza3NBcnIiLCJrIiwiY2F0ZWdvcmllc0FyciIsImNhdGVnb3JpZXNJZE9iaiIsIm9iaiIsImN1cnJlbnRWYWx1ZUNvdW50ZXIiLCJwQ291bnRlciIsImtleSIsImNvbWJpZW5kVGFza1dvcmRzIiwiYXJyYXkiLCJ3b3JrIiwicGVyc29uYWwiLCJzaG9wcGluZyIsImZhbWlseSIsIndhcm5pbmciLCJjb3VudFRhc2tzIiwiY3JlYXRlTmV3VGFzayIsImJ0bldyYXBwZXIiLCJidG5DYW5jZWwiLCJidG5Eb25lIiwibmV3VGFza0xpc3QiLCJuZXdUYXNrSXRlbSIsIm5ld1Rhc2tEb25lIiwibmV3VGFza0lucHV0IiwiY3JlYXRlVGFzayIsImN1cnJlbnQiLCJuZXdMaSIsIm5ld0RpdiIsIm5ld0lucHV0IiwibmFtZSIsInR5cGUiLCJwbGFjZWhvbGRlciIsImlucHV0TmV3VGFzayIsIml0ZW1UZW1wbGF0ZSIsImtleUNvZGUiLCJwcmV2ZW50RGVmYXVsdCIsIm5ld0l0ZW1UZW1wbGF0ZSJdLCJtYXBwaW5ncyI6IkFBQUEsSUFBSUEsU0FBV0MsU0FBU0MsY0FBYyxjQUNsQ0MsYUFBZUYsU0FBU0MsY0FBYyw2QkFDdENFLFdBQWFILFNBQVNDLGNBQWMsZ0JBQ3BDRyxtQkFBcUJKLFNBQVNDLGNBQWMsMEJBQzVDSSxhQUFlLEdBQUdDLE1BQU1DLEtBQUtSLFNBQVNTLGlCQUFpQixpQkFJdkRDLFNBQVdULFNBQVNDLGNBQWMsc0JBRWxDUSxVQUNGTixXQUFXTyxVQUFVQyxJQUFJLHFCQUkzQixJQUFJQyxXQUFhLFNBQVVDLEdBRXpCQSxFQUFZQyxpQkFBaUIsUUFBUyxTQUFTQyxHQUd6Q0EsRUFBRUMsT0FBT04sVUFBVU8sU0FBUyxpQkFDOUJGLEVBQUVDLE9BQU9OLFVBQVVRLE9BQU8scUJBQzFCSCxFQUFFQyxP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YSxTQUFTQyxHQUNuQkEsSUFDSEEsRUFBVSxHQUdaLElBQUlDLEVBQVFoRyxTQUFTMkQsY0FBYyxNQUNuQ3FDLEVBQU10RixVQUFVQyxJQUFJLGtCQUNwQixJQUFJc0YsRUFBU2pHLFNBQVMyRCxjQUFjLE9BQ3BDc0MsRUFBT3ZGLFVBQVVDLElBQUksbUJBQ3JCLElBQUl1RixFQUFXbEcsU0FBUzJELGNBQWMsU0FRdEMsT0FQQXVDLEVBQVM1QyxHQUFLLGVBQWdCeUMsRUFDOUJHLEVBQVNDLEtBQU8sV0FDaEJELEVBQVNFLEtBQU8sT0FDaEJGLEVBQVNHLFlBQWMsc0JBQ3ZCTCxFQUFNbkMsWUFBWW9DLEdBQ2xCRCxFQUFNbkMsWUFBWXFDLEdBRVhGLEdBSUxNLGFBQWV0RyxTQUFTQyxjQUFjLGVBQ3RDc0csYUFBZXZHLFNBQVNDLGNBQWMsbUJBRzFDc0csYUFBYXpGLGlCQUFpQixVQUFXLFNBQVNDLEdBRWhELElBQUkyRSxFQUFjMUYsU0FBU0MsY0FBYyxtQkFFekMsR0FBa0IsS0FBZGMsRUFBRXlGLFFBQWdCLENBQ3BCekYsRUFBRTBGLGlCQUNGLElBQUlDLEVBQWtCWixXQUFXLEdBQ2pDSixFQUFZN0IsWUFBWTZDIiwiZmlsZSI6InRhc2stbWFyay1hbmltYXRlLmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIHRhc2tMaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnRhc2stbGlzdCcpO1xyXG52YXIgdGVtcGxhdGVMaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmxpc3QtdGVtcGxhdGVfX3Rhc2stbGlzdCcpO1xyXG52YXIgZGVsZXRlSWNvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5kZWxldGUtaWNvbicpO1xyXG52YXIgZGVsZXRlSWNvblRlbXBsYXRlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmRlbGV0ZS1pY29uLS10ZW1wbGF0ZScpO1xyXG52YXIgdGFza1JlYWR5QXJyID0gW10uc2xpY2UuY2FsbCh0YXNrTGlzdC5xdWVyeVNlbGVjdG9yQWxsKCcudGFza19fcmVhZHknKSk7XHJcblxyXG4vLyDQk9CQ0JvQntCn0JrQkCDQmCDQl9CQ0KfQldCg0JrQmNCS0JDQndCY0JUg0KLQkNCh0JrQkFxyXG5cclxudmFyIGRvbmVNYXJrID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnRhc2tfX3JlYWR5LS1kb25lJyk7XHJcblxyXG5pZiAoZG9uZU1hcmspIHtcclxuICBkZWxldGVJY29uLmNsYXNzTGlzdC5hZGQoJ2RlbGV0ZS1pY29uLS1zaG93Jyk7XHJcbn1cclxuXHJcblxyXG52YXIgb25UYXNrRG9uZSA9IGZ1bmN0aW9uICh3cmFwcGVyTm9kZSkge1xyXG5cclxuICB3cmFwcGVyTm9kZS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKGUpe1xyXG5cclxuICAgIC8vINCj0YHRgtCw0L3QvtCy0LrQsCDQutCw0LvQvtGH0LrQuCDRgtCw0YHQutCwXHJcbiAgICBpZiAoZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCd0YXNrX19yZWFkeScpKSB7XHJcbiAgICAgIGUudGFyZ2V0LmNsYXNzTGlzdC50b2dnbGUoJ3Rhc2tfX3JlYWR5LS1kb25lJyk7XHJcbiAgICAgIGUudGFyZ2V0Lm5leHRFbGVtZW50U2libGluZy5jbGFzc0xpc3QudG9nZ2xlKCd0YXNrX190ZXh0LS1kb25lJyk7XHJcbiAgICAgIGUudGFyZ2V0LnBhcmVudEVsZW1lbnQuY2xhc3NMaXN0LnRvZ2dsZSgndGFzay0tZG9uZScpO1xyXG5cclxuICAgICAgLy8g0J/QvtGP0LLQu9C10L3QuNC1INC60L7RgNC30LjQvdC60Lgg0L/RgNC4INCy0YvQsdC+0YDQtSDRgtCw0YHQutCwXHJcbiAgICAgIHZhciBkb25lTWFyayA9IHdyYXBwZXJOb2RlLnF1ZXJ5U2VsZWN0b3IoJy50YXNrX19yZWFkeS0tZG9uZScpO1xyXG5cclxuICAgICAgaWYgKGRvbmVNYXJrKSB7XHJcbiAgICAgICAgZGVsZXRlSWNvbi5jbGFzc0xpc3QuYWRkKCdkZWxldGUtaWNvbi0tc2hvdycpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGRlbGV0ZUljb24uY2xhc3NMaXN0LnJlbW92ZSgnZGVsZXRlLWljb24tLXNob3cnKTtcclxuICAgICAgfVxyXG4gICAgfSBcclxuICAgIFxyXG4gIH0pO1xyXG59XHJcblxyXG5vblRhc2tEb25lKHRhc2tMaXN0KTtcclxuLy8gXHJcbi8vIFxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcbi8vINCj0JTQkNCb0JXQndCY0JUg0KLQkNCh0JrQkFxyXG5cclxuXHJcbmRlbGV0ZUljb24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoZSkge1xyXG4gIHZhciB0YXNrRG9uZUFyciA9IFtdLnNsaWNlLmNhbGwoZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnRhc2stLWRvbmUnKSk7XHJcblxyXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgdGFza0RvbmVBcnIubGVuZ3RoOyBpKyspIHtcclxuICAgIHRhc2tEb25lQXJyW2ldLnJlbW92ZSgpO1xyXG4gICAgXHJcbiAgfVxyXG5cclxuICBkZWxldGVJY29uLmNsYXNzTGlzdC5yZW1vdmUoJ2RlbGV0ZS1pY29uLS1zaG93Jyk7XHJcblxyXG4gIHVwZGF0ZURhdGEoKTtcclxuXHJcbn0pO1xyXG5cclxuLy8gXHJcbi8vIFxyXG5cclxuXHJcbi8vIGJ0bi1wbHVzXHJcblxyXG52YXIgZm9ybUJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5mb3JtX19idG4nKTtcclxudmFyIGJ0bkxpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY3JlYXRlX19pdGVtcycpO1xyXG52YXIgb3ZlcmxheSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5vdmVybGF5Jyk7XHJcblxyXG5mb3JtQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oZSl7XHJcbiAgZm9ybUJ0bi5jbGFzc0xpc3QudG9nZ2xlKCdmb3JtX19idG4tLWFjdGl2ZScpO1xyXG4gIGJ0bkxpc3QuY2xhc3NMaXN0LnRvZ2dsZSgnY3JlYXRlX19pdGVtcy0tYWN0aXZlJyk7XHJcbiAgb3ZlcmxheS5jbGFzc0xpc3QudG9nZ2xlKCdvdmVybGF5LS1hY3RpdmUnKTtcclxufSk7XHJcbi8vIFxyXG4vLyBcclxuXHJcblxyXG5cclxuLy8gbGlzdC10ZW1wbGF0ZVxyXG5cclxuLy8g0KHQntCX0JTQkNCd0JjQlSDQl9CQ0JPQntCb0J7QktCa0JAg0Jgg0KbQktCV0KLQkCDQmtCQ0KDQotCe0KfQmtCYXHJcbnZhciBsaXN0VGVtcGxhdGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubGlzdC10ZW1wbGF0ZScpO1xyXG52YXIgdGVtcGxhdGVUaXRpbGUgPSBsaXN0VGVtcGxhdGUucXVlcnlTZWxlY3RvcignLmxpc3QtdGVtcGxhdGVfX3RpdGxlJyk7XHJcbnZhciB0ZW1wbGF0ZUNvdW50ID0gbGlzdFRlbXBsYXRlLnF1ZXJ5U2VsZWN0b3IoJy5saXN0LXRlbXBsYXRlX19jb3VudCcpO1xyXG5cclxuLy8gdGVtcGxhdGUtbGlzdFxyXG52YXIgdGVtcGxhdGVUYXNrTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5saXN0LXRlbXBsYXRlX190YXNrLWxpc3QnKTtcclxudmFyIHRlbXBsYXRlSXRlbSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5saXN0LXRlbXBsYXRlX190YXNrLS10ZW1wbGF0ZScpO1xyXG52YXIgdGVtcGxhdGVSZWFkeSA9IHRlbXBsYXRlSXRlbS5xdWVyeVNlbGVjdG9yKCcubGlzdC10ZW1wbGF0ZV9fdGFzay1yZWFkeScpO1xyXG52YXIgdGVtcGxhdGVUZXh0ID0gdGVtcGxhdGVJdGVtLnF1ZXJ5U2VsZWN0b3IoJy5saXN0LXRlbXBsYXRlX190YXNrLXRleHQnKTtcclxudmFyIHRlbXBsYXRlRGF0ZSA9IHRlbXBsYXRlSXRlbS5xdWVyeVNlbGVjdG9yKCd0YXNrX19kYXRlJyk7XHJcblxyXG5cclxudmFyIGNhdGVnb3J5TGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jYXRlZ29yeV9fbGlzdCcpO1xyXG5cclxuXHJcblxyXG5cclxuXHJcbnZhciBjYWxsYmFjayA9IGZ1bmN0aW9uKGUpe1xyXG4gIHZhciB0YXJnID0gZS50YXJnZXQ7XHJcblxyXG4gIC8vINGE0LjQutGBINCy0YvQsdC+0YDQsCDQutCw0YDRgtC+0YfQutC4XHJcbiAgaWYgKGV2ZW50LnRhcmdldC5wYXJlbnRFbGVtZW50LnRhZ05hbWUgPT09ICdMSScpIHtcclxuICAgdGFyZyA9IGV2ZW50LnRhcmdldC5wYXJlbnRFbGVtZW50O1xyXG4gIH1cclxuICBcclxuXHJcblxyXG5cclxuICAvLyDQv9C+0LvRg9GH0LjQvCDRhtCy0LXRgiwg0LfQsNCz0L7Qu9C+0LLQvtC6LCDRgdGH0LXRgtGH0LjQuiDQutCw0YLQtdCz0L7RgNC40LhcclxuICB2YXIgY29sb3JUYXJnZXQgPSBnZXRDb21wdXRlZFN0eWxlKHRhcmcpLmdldFByb3BlcnR5VmFsdWUoJ2JhY2tncm91bmQtY29sb3InKTtcclxuICB2YXIgdGl0bGVUYXJnZXQgPSB0YXJnLmZpcnN0RWxlbWVudENoaWxkLmlubmVyVGV4dDtcclxuICB2YXIgY291bnRlclRhcmdldCA9IHRhcmcubGFzdEVsZW1lbnRDaGlsZC5pbm5lclRleHQ7XHJcblxyXG5cclxuICAvL9C30LDQtNCw0LTQuNC8INGG0LLQtdGCLCDQt9Cw0LPQvtC70L7QstC+0LosINGB0YfQtdGC0YfQuNC6INC60LDRgNGC0L7Rh9C60LhcclxuICBsaXN0VGVtcGxhdGUuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gY29sb3JUYXJnZXQ7XHJcbiAgdGVtcGxhdGVUaXRpbGUudGV4dENvbnRlbnQgPSAgdGl0bGVUYXJnZXQ7XHJcbiAgdGVtcGxhdGVDb3VudC50ZXh0Q29udGVudCA9IGNvdW50ZXJUYXJnZXQ7XHJcblxyXG5cclxuXHJcbiAgLy8gXHJcbiAgLy8gXHJcblxyXG4gIC8vINGB0L7QsdC10YDQtdC8INGB0L/QuNGB0L7QuiDQt9Cw0LTQsNGHXHJcbiAgdmFyIGlkQ2F0ZWdvcnkgPSB0YXJnLmlkLnNsaWNlKDQpO1xyXG5cclxuXHJcbiAgZnVuY3Rpb24gY3JlYXRlVGFza0VsZW0oKSB7XHJcblxyXG4gICAgdmFyIHRlbXBsYXRlVGFza0FyciA9IFtdLnNsaWNlLmNhbGwodGFza0xpc3QucXVlcnlTZWxlY3RvckFsbCgnLnRhc2stLScgKyBpZENhdGVnb3J5KSk7XHJcblxyXG4gICAgdmFyIGZyYWdtZW50ID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpO1xyXG4gICAgXHJcblxyXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0ZW1wbGF0ZVRhc2tBcnIubGVuZ3RoOyBpKyspIHtcclxuICAgICAgdmFyIG5ld0l0ZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgbmV3SXRlbS5jbGFzc0xpc3QuYWRkKCdsaXN0LXRlbXBsYXRlX190YXNrJyk7XHJcbiAgICAgIG5ld0l0ZW0uY2xhc3NMaXN0LmFkZCgnbGlzdC10ZW1wbGF0ZV9fdGFzay0tdGVtcGxhdGUnKTtcclxuXHJcbiAgICAgIHZhciBuZXdJdGVtUmVhZHkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgbmV3SXRlbVJlYWR5LmNsYXNzTGlzdC5hZGQoJ2xpc3QtdGVtcGxhdGVfX3Rhc2stcmVhZHknKTtcclxuICAgICAgbmV3SXRlbS5hcHBlbmRDaGlsZChuZXdJdGVtUmVhZHkpO1xyXG5cclxuICAgICAgdmFyIG5ld0l0ZW1UZXh0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xyXG4gICAgICBuZXdJdGVtVGV4dC5jbGFzc0xpc3QuYWRkKCdsaXN0LXRlbXBsYXRlX190YXNrLXRleHQnKTtcclxuICAgICAgbmV3SXRlbS5hcHBlbmRDaGlsZChuZXdJdGVtVGV4dCk7XHJcblxyXG4gICAgICB2YXIgbmV3SXRlbURhdGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7XHJcbiAgICAgIG5ld0l0ZW1EYXRlLmNsYXNzTGlzdC5hZGQoJ2xpc3QtdGVtcGxhdGVfX3Rhc2stZGF0ZScpO1xyXG4gICAgICBuZXdJdGVtLmFwcGVuZENoaWxkKG5ld0l0ZW1EYXRlKTtcclxuICAgICAgbmV3SXRlbVRleHQudGV4dENvbnRlbnQgPSB0ZW1wbGF0ZVRhc2tBcnJbaV0udGV4dENvbnRlbnQ7XHJcbiAgICAgIGZyYWdtZW50LmFwcGVuZENoaWxkKG5ld0l0ZW0pO1xyXG4gICAgICBcclxuICAgIH1cclxuICAgIFxyXG4gICAgdGVtcGxhdGVUYXNrTGlzdC5pbm5lckhUTUw9ICcnO1xyXG4gICAgdGVtcGxhdGVUYXNrTGlzdC5hcHBlbmRDaGlsZChmcmFnbWVudCk7XHJcbiAgfVxyXG5cclxuXHJcbiAgY3JlYXRlVGFza0VsZW0oKTtcclxuICBcclxuXHJcbiAgXHJcbn07XHJcblxyXG5jYXRlZ29yeUxpc3QuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBjYWxsYmFjayk7XHJcblxyXG5vblRhc2tEb25lKHRlbXBsYXRlVGFza0xpc3QpO1xyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG4vLyDQk9Cw0LvQvtGH0LrQsCDQuCDQv9C+0Y/QstC70LXQvdC40LUg0LrQvtGA0LfQuNC90LrQuCDQsiDQutCw0YDRgtC+0YfQutC1XHJcblxyXG52YXIgb25UYXNrRG9uZVRlbXBsYXRlID0gZnVuY3Rpb24gKHdyYXBwZXJOb2RlKSB7XHJcblxyXG4gIHdyYXBwZXJOb2RlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oZSl7XHJcblxyXG4gICAgLy8g0KPRgdGC0LDQvdC+0LLQutCwINC60LDQu9C+0YfQutC4INGC0LDRgdC60LBcclxuICAgIGlmIChlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2xpc3QtdGVtcGxhdGVfX3Rhc2stcmVhZHknKSkge1xyXG4gICAgICBlLnRhcmdldC5jbGFzc0xpc3QudG9nZ2xlKCdsaXN0LXRlbXBsYXRlX190YXNrLXJlYWR5LS1kb25lJyk7XHJcbiAgICAgIGUudGFyZ2V0Lm5leHRFbGVtZW50U2libGluZy5jbGFzc0xpc3QudG9nZ2xlKCdsaXN0LXRlbXBsYXRlX190YXNrLXRleHQtLWRvbmUnKTtcclxuICAgICAgZS50YXJnZXQucGFyZW50RWxlbWVudC5jbGFzc0xpc3QudG9nZ2xlKCdsaXN0LXRlbXBsYXRlX190YXNrLS1kb25lJyk7XHJcblxyXG4gICAgICAvLyDQn9C+0Y/QstC70LXQvdC40LUg0LrQvtGA0LfQuNC90LrQuCDQv9GA0Lgg0LLRi9Cx0L7RgNC1INGC0LDRgdC60LBcclxuICAgICAgdmFyIGRvbmVNYXJrID0gd3JhcHBlck5vZGUucXVlcnlTZWxlY3RvcignLmxpc3QtdGVtcGxhdGVfX3Rhc2stcmVhZHktLWRvbmUnKTtcclxuXHJcbiAgICAgIGlmIChkb25lTWFyaykge1xyXG4gICAgICAgIGRlbGV0ZUljb25UZW1wbGF0ZS5jbGFzc0xpc3QuYWRkKCdkZWxldGUtaWNvbi0tc2hvdycpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGRlbGV0ZUljb25UZW1wbGF0ZS5jbGFzc0xpc3QucmVtb3ZlKCdkZWxldGUtaWNvbi0tc2hvdycpO1xyXG4gICAgICB9XHJcbiAgICB9IFxyXG4gICAgXHJcbiAgfSk7XHJcbn1cclxuXHJcbm9uVGFza0RvbmVUZW1wbGF0ZSh0ZW1wbGF0ZUxpc3QpO1xyXG5cclxuLy8g0KPQlNCQ0JvQldCd0JjQlSDQotCQ0KHQmtCQINCSINCa0JDQoNCi0J7Qp9Ca0JVcclxuXHJcbmRlbGV0ZUljb25UZW1wbGF0ZS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7XHJcbiAgdmFyIHRhc2tEb25lQXJyID0gW10uc2xpY2UuY2FsbChkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcubGlzdC10ZW1wbGF0ZV9fdGFzay0tZG9uZScpKTtcclxuXHJcbiAgdmFyIHRleHRDb250ZW50QXJyID0gW107XHJcbiAgXHJcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCB0YXNrRG9uZUFyci5sZW5ndGg7IGkrKykge1xyXG4gICAgdGV4dENvbnRlbnRBcnJbaV0gPSB0YXNrRG9uZUFycltpXS50ZXh0Q29udGVudDtcclxuICAgIHRhc2tEb25lQXJyW2ldLnJlbW92ZSgpO1xyXG4gICAgXHJcbiAgfVxyXG5cclxuICBjb25zb2xlLmRpcih0ZXh0Q29udGVudEFycik7XHJcblxyXG5cclxuXHJcbiAgdmFyIHRhc2tzQXJyID0gW10uc2xpY2UuY2FsbCh0YXNrTGlzdC5xdWVyeVNlbGVjdG9yQWxsKCcudGFzaycpKTtcclxuXHJcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCB0YXNrRG9uZUFyci5sZW5ndGg7IGkrKykge1xyXG4gICAgXHJcblxyXG4gICAgZm9yICh2YXIgayA9IDA7IGsgPCB0YXNrc0Fyci5sZW5ndGg7IGsrKykge1xyXG4gICAgICBpZiAodGFza3NBcnJba10udGV4dENvbnRlbnQgPT09IHRhc2tEb25lQXJyW2ldLnRleHRDb250ZW50KSB7XHJcbiAgICAgICAgdGFza3NBcnJba10ucmVtb3ZlKCk7XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICB9XHJcbiAgICBcclxuICB9XHJcblxyXG5cclxuXHJcbiAgZGVsZXRlSWNvblRlbXBsYXRlLmNsYXNzTGlzdC5yZW1vdmUoJ2RlbGV0ZS1pY29uLS1zaG93Jyk7XHJcblxyXG5cclxuICB1cGRhdGVEYXRhKCk7XHJcblxyXG59KTtcclxuXHJcblxyXG4vLyDQmtCe0JvQmNCn0JXQodCi0JLQniDQl9CQ0JTQkNCnXHJcbiBcclxuXHJcblxyXG52YXIgdXBkYXRlRGF0YSA9IGZ1bmN0aW9uICgpIHtcclxuICAvLyDRgdC+0LHQtdGA0LXQvCDQuCDRgdCz0YDRg9C/0LjRgNGD0LXQvCDRgtCw0YHQutC4INC/0L4g0LrQsNGC0LXQs9C+0YDQuNGP0Lwg0LIg0L7QsdGM0LXQutGCXHJcblxyXG4gIHZhciB0YXNrc0FyciA9IFtdLnNsaWNlLmNhbGwodGFza0xpc3QucXVlcnlTZWxlY3RvckFsbCgnLnRhc2snKSk7XHJcblxyXG4gIHZhciBjYXRlZ29yaWVzQXJyID0gW10uc2xpY2UuY2FsbChjYXRlZ29yeUxpc3QucXVlcnlTZWxlY3RvckFsbCgnLmNhdGVnb3J5X19pdGVtJykpO1xyXG5cclxuICB2YXIgY2F0ZWdvcmllc0lkT2JqID0ge307XHJcbiAgXHJcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBjYXRlZ29yaWVzQXJyLmxlbmd0aDsgaSsrKSB7XHJcbiAgICBjYXRlZ29yaWVzSWRPYmpbY2F0ZWdvcmllc0FycltpXS5pZC5zbGljZSg0KV0gPSAwO1xyXG4gIH1cclxuICBcclxuXHJcbiAgXHJcbiAgXHJcbiAgXHJcbiAgLy8gXHJcblxyXG4gIC8vINCf0J7QlNCh0KfQldCiINCi0JDQodCa0J7QkiDQn9CeINCa0JDQotCV0JPQntCg0JjQr9CcXHJcblxyXG4gIHZhciBjb3VudFRhc2tzID0gZnVuY3Rpb24gKGFycmF5LCBvYmopIHtcclxuICAgIFxyXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcnJheS5sZW5ndGg7IGkrKykge1xyXG5cclxuICAgICAgXHJcbiAgICAgIGlmIChhcnJheVtpXS5jbGFzc0xpc3QuY29udGFpbnMoJ3Rhc2stLXdvcmsnKSkge1xyXG4gICAgICAgIG9iai53b3JrKys7XHJcbiAgICAgIH0gZWxzZSBpZiAoYXJyYXlbaV0uY2xhc3NMaXN0LmNvbnRhaW5zKCd0YXNrLS1wZXJzb25hbCcpKXtcclxuICAgICAgICBvYmoucGVyc29uYWwrKztcclxuICAgICAgfSBlbHNlIGlmIChhcnJheVtpXS5jbGFzc0xpc3QuY29udGFpbnMoJ3Rhc2stLXNob3BwaW5nJykpe1xyXG4gICAgICAgIG9iai5zaG9wcGluZysrO1xyXG4gICAgICB9IGVsc2UgaWYgKGFycmF5W2ldLmNsYXNzTGlzdC5jb250YWlucygndGFzay0tZmFtaWx5Jykpe1xyXG4gICAgICAgIG9iai5mYW1pbHkrKztcclxuICAgICAgfSBlbHNlIGlmIChhcnJheVtpXS5jbGFzc0xpc3QuY29udGFpbnMoJ3Rhc2stLXdhcm5pbmcnKSl7XHJcbiAgICAgICAgb2JqLndhcm5pbmcrKztcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgIH1cclxuICAgIHJldHVybiBvYmo7XHJcbiAgfVxyXG5cclxuXHJcbiAgXHJcblxyXG4gIHZhciByZXN1bCA9IGNvdW50VGFza3ModGFza3NBcnIsIGNhdGVnb3JpZXNJZE9iaik7XHJcbiAgXHJcbiAgLy8gXHJcblxyXG4gIC8vINCe0JrQntCd0KfQkNCd0JjQlSDQodCb0J7QktCQIFwi0JfQkNCU0JDQp9CQXCJcclxuXHJcbiAgdmFyIGNvbWJpZW5kVGFza1dvcmRzID0gZnVuY3Rpb24gKG9iaikge1xyXG4gICAgXHJcbiAgICB2YXIgY3VycmVudFZhbHVlQ291bnRlcjtcclxuICAgIHZhciBwQ291bnRlcjtcclxuICAgIGZvciAoa2V5IGluIG9iaikge1xyXG4gICAgICBwQ291bnRlciA9IGNhdGVnb3J5TGlzdC5xdWVyeVNlbGVjdG9yKCcjY2F0XycgKyBrZXkgKyAnIC5jYXRlZ29yeV9fY291bnQnKTtcclxuICAgICAgY3VycmVudFZhbHVlQ291bnRlciA9IG9ialtrZXldIDtcclxuICAgICAgaWYgKGN1cnJlbnRWYWx1ZUNvdW50ZXIgPT09IDApIHtcclxuICAgICAgICBwQ291bnRlci5pbm5lclRleHQgPSAn0J3QtdGCINC30LDQtNCw0YcnO1xyXG4gICAgICB9IGVsc2UgaWYoY3VycmVudFZhbHVlQ291bnRlciA9PT0gMSl7XHJcbiAgICAgICAgcENvdW50ZXIuaW5uZXJUZXh0ID0gY3VycmVudFZhbHVlQ291bnRlciArICcg0LfQsNC00LDRh9CwJztcclxuICAgICAgfSBlbHNlIGlmKGN1cnJlbnRWYWx1ZUNvdW50ZXIgPj0gMiAmJiBjdXJyZW50VmFsdWVDb3VudGVyIDw9IDQpe1xyXG4gICAgICAgIHBDb3VudGVyLmlubmVyVGV4dCA9IGN1cnJlbnRWYWx1ZUNvdW50ZXIgKyAnINC30LDQtNCw0YfQuCc7XHJcbiAgICAgIH0gZWxzZSBpZiAoY3VycmVudFZhbHVlQ291bnRlciA+PSA1ICYmIGN1cnJlbnRWYWx1ZUNvdW50ZXIgPD0gMjApIHtcclxuICAgICAgICBwQ291bnRlci5pbm5lclRleHQgPSBjdXJyZW50VmFsdWVDb3VudGVyICsgJyDQt9Cw0LTQsNGHJztcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICB9XHJcblxyXG4gIGNvbWJpZW5kVGFza1dvcmRzKHJlc3VsKTtcclxuXHJcbn1cclxuXHJcbnVwZGF0ZURhdGEoKTtcclxuICBcclxuICBcclxuLy8g0J7QotCg0JjQodCe0JLQmtCQINCe0JrQndCQINCd0J7QktCe0JPQniDQotCQ0KHQmtCQIFxyXG5cclxudmFyIGNyZWF0ZU5ld1Rhc2sgPSBmdW5jdGlvbigpIHtcclxuXHJcbi8vINC+0LrQvdC+XHJcbiAgdmFyIG5ld1Rhc2tXaW5kb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICBuZXdUYXNrV2luZG93LmNsYXNzTGlzdC5hZGQoJ25ldy10YXNrJyk7XHJcblxyXG4vLyDQutC90L7Qv9C60Lgg0L7RgtC80LXQvdCwINC4INCz0L7RgtC+0LLQviBcclxuICB2YXIgYnRuV3JhcHBlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gIHZhciBidG5DYW5jZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTtcclxuICB2YXIgYnRuRG9uZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpO1xyXG5cclxuICBidG5XcmFwcGVyLmFwcGVuZENoaWxkKGJ0bkNhbmNlbCk7XHJcbiAgYnRuV3JhcHBlci5hcHBlbmRDaGlsZChidG5Eb25lKTtcclxuXHJcbi8vINGB0L/QuNGB0L7Qui3QvtCx0LXRgNGC0LrQsCDQuCDQvtC00LjQvSDRgtCw0YHQulxyXG4gIHZhciBuZXdUYXNrTGlzdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gIHZhciBuZXdUYXNrSXRlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gIHZhciBuZXdUYXNrRG9uZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gIHZhciBuZXdUYXNrSW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpO1xyXG5cclxuICBuZXdUYXNrSXRlbS5hcHBlbmRDaGlsZChuZXdUYXNrRG9uZSk7XHJcbiAgbmV3VGFza0l0ZW0uYXBwZW5kQ2hpbGQobmV3VGFza0lucHV0KTtcclxuICBuZXdUYXNrTGlzdC5hcHBlbmRDaGlsZChuZXdUYXNrSXRlbSk7XHJcbn1cclxuXHJcblxyXG5cclxuLy8g0KHQntCX0JTQkNCd0JjQlSDQndCe0JLQntCT0J4g0JjQndCf0KPQotCQINCU0JvQryDQl9CQ0J/QmNCh0JhcclxuXHJcbnZhciBjcmVhdGVUYXNrID0gZnVuY3Rpb24oY3VycmVudCkge1xyXG4gIGlmICghY3VycmVudCkge1xyXG4gICAgY3VycmVudCA9IDA7XHJcbiAgfVxyXG5cclxuICB2YXIgbmV3TGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xyXG4gIG5ld0xpLmNsYXNzTGlzdC5hZGQoJ25ldy10YXNrX19pdGVtJyk7XHJcbiAgdmFyIG5ld0RpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gIG5ld0Rpdi5jbGFzc0xpc3QuYWRkKCduZXctdGFza19fcmVhZHknKTtcclxuICB2YXIgbmV3SW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpO1xyXG4gIG5ld0lucHV0LmlkID0gJ25ldy10YXNrLScgKyArK2N1cnJlbnQ7XHJcbiAgbmV3SW5wdXQubmFtZSA9ICduZXctdGFzayc7XHJcbiAgbmV3SW5wdXQudHlwZSA9ICd0ZXh0JztcclxuICBuZXdJbnB1dC5wbGFjZWhvbGRlciA9ICfQp9GC0L4g0L3Rg9C20L3QviDRgdC00LXQu9Cw0YLRjCA/JztcclxuICBuZXdMaS5hcHBlbmRDaGlsZChuZXdEaXYpO1xyXG4gIG5ld0xpLmFwcGVuZENoaWxkKG5ld0lucHV0KTtcclxuXHJcbiAgcmV0dXJuIG5ld0xpO1xyXG5cclxufTtcclxuXHJcbnZhciBpbnB1dE5ld1Rhc2sgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjbmV3LXRhc2stMScpO1xyXG52YXIgaXRlbVRlbXBsYXRlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm5ldy10YXNrX19pdGVtJyk7XHJcblxyXG5cclxuaXRlbVRlbXBsYXRlLmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBmdW5jdGlvbihlKXtcclxuICBcclxuICB2YXIgbmV3VGFza0xpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubmV3LXRhc2tfX2xpc3QnKTtcclxuXHJcbiAgaWYgKGUua2V5Q29kZSA9PT0gMTMpIHtcclxuICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgIHZhciBuZXdJdGVtVGVtcGxhdGUgPSBjcmVhdGVUYXNrKDApOyBcclxuICAgIG5ld1Rhc2tMaXN0LmFwcGVuZENoaWxkKG5ld0l0ZW1UZW1wbGF0ZSk7XHJcbiB9XHJcbiAgXHJcbiAgLy8gY29uc29sZS5kaXIoZS50YXJnZXQpO1xyXG4gIC8vIGlmIChlLnRhcmdldC52YWx1ZS5sZW5ndGggPT09IDEpIHtcclxuICAvLyAgIHZhciBuZXdJdGVtVGVtcGxhdGUgPSBjcmVhdGVUYXNrKDApOyBcclxuICAvLyAgIG5ld1Rhc2tMaXN0LmFwcGVuZENoaWxkKG5ld0l0ZW1UZW1wbGF0ZSk7XHJcbiAgLy8gfSBlbHNlIGlmIChlLnRhcmdldC52YWx1ZS5sZW5ndGggPT09IDApIHtcclxuICAvLyAgIG5ld0l0ZW1UZW1wbGF0ZS5yZW1vdmUoKTtcclxuICAvLyB9XHJcblxyXG4vLyDRg9C00LDQu9C10L3QuNC1INC/0YPRgdGC0L7Qs9C+INC40L3Qv9GD0YLQsFxyXG4gICAvLyBpZiAoIWUudGFyZ2V0LnZhbHVlKSB7XHJcbiAgLy8gICBpdGVtVGVtcGxhdGUucmVtb3ZlKCk7XHJcbiAgLy8gfVxyXG5cclxufSk7Il19
